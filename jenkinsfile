// -*- mode: groovy -*-
// vim: set filetype=groovy :
def app_name = "package-management-service"
def remoteUrl = "https://github.com/JahanzebKhan98/jenkins-testing.git"
def label = "jenkins-agent-${UUID.randomUUID().toString()}"
def containerName = "build-container-${UUID.randomUUID().toString()}"


import groovy.json.JsonOutput

podTemplate(
    label: label,
    cloud: "kubernetes",
    nodeUsageMode: "EXCLUSIVE",
    containers: [
        containerTemplate(
            name: "python",
            image: 'python:3.8.2-slim-buster',
            ttyEnabled: true,
            privileged: true,
            stdin: true,
        ),

    ],
) 

{
    node(label) {

        stage('Checkout SCM') {
            echo "Git Cloned"
        }

        stage("Install pre-req") {
            container("python"){
                sh 'pip install --upgrade pip'
                sh 'pip install -r requirements.txt'
            }
        }

        stage("Build") {
            sh 'python pintrest_scrapper.py'
        }

    }
}
